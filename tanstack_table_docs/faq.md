## å¦‚ä½•é¿å…æ— é™æ¸²æŸ“å¾ªç¯ï¼Ÿ

å¦‚æœä½ åœ¨ä½¿ç”¨ Reactï¼Œæœ‰ä¸€ä¸ªå¸¸è§çš„é™·é˜±ä¼šå¯¼è‡´æ— é™æ¸²æŸ“ã€‚
å¦‚æœä½ æ²¡æœ‰ä¸º `columns`ã€`data` æˆ– `state` æä¾›ç¨³å®šçš„å¼•ç”¨ï¼Œé‚£ä¹ˆå½“è¡¨æ ¼çŠ¶æ€å‘ç”Ÿä»»ä½•å˜åŒ–æ—¶ï¼ŒReact å°±ä¼šé™·å…¥æ— é™é‡æ–°æ¸²æŸ“çš„å¾ªç¯ã€‚

ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿè¿™æ˜¯ TanStack Table çš„ bug å—ï¼Ÿ**ä¸**ï¼Œä¸æ˜¯ã€‚
_è¿™æœ¬è´¨ä¸Šæ˜¯ React çš„å·¥ä½œæ–¹å¼_ï¼Œæ­£ç¡®ç®¡ç†ä½ çš„ columnsã€data å’Œ state å¯ä»¥é˜²æ­¢è¿™ç§æƒ…å†µå‘ç”Ÿã€‚

TanStack Table çš„è®¾è®¡æ˜¯ï¼šå½“ä¼ å…¥è¡¨æ ¼çš„ `data` æˆ– `columns` å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæˆ–è€…å½“è¡¨æ ¼çš„ä»»ä½•çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œéƒ½ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ã€‚

> æœªèƒ½ä¸º `columns` æˆ– `data` æä¾›ç¨³å®šçš„å¼•ç”¨ä¼šå¯¼è‡´æ— é™é‡æ–°æ¸²æŸ“å¾ªç¯ã€‚

### é™·é˜±ä¸€ï¼šåœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½åˆ›å»ºæ–°çš„ columns æˆ– data

```js
export default function MyComponent() {
  //ğŸ˜µ é”™è¯¯ï¼šè¿™ä¼šå¯¼è‡´æ— é™é‡æ–°æ¸²æŸ“å¾ªç¯ï¼Œå› ä¸º `columns` åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½è¢«é‡æ–°å®šä¹‰ä¸ºä¸€ä¸ªæ–°æ•°ç»„ï¼
  const columns = [
    // ...
  ];

  //ğŸ˜µ é”™è¯¯ï¼šè¿™ä¼šå¯¼è‡´æ— é™é‡æ–°æ¸²æŸ“å¾ªç¯ï¼Œå› ä¸º `data` åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½è¢«é‡æ–°å®šä¹‰ä¸ºä¸€ä¸ªæ–°æ•°ç»„ï¼
  const data = [
    // ...
  ];

  //âŒ Columns å’Œ data ä¸ `useReactTable` å®šä¹‰åœ¨åŒä¸€ä½œç”¨åŸŸå†…ï¼Œä¸”æ²¡æœ‰ç¨³å®šå¼•ç”¨ï¼Œå°†å¯¼è‡´æ— é™å¾ªç¯ï¼
  const table = useReactTable({
    columns,
    data,
  });

  return <table>...</table>;
}
```

### è§£å†³æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ useMemo æˆ– useState æä¾›ç¨³å®šå¼•ç”¨

åœ¨ React ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡å°†å˜é‡å®šä¹‰åœ¨ç»„ä»¶å¤–éƒ¨/ä¸Šæ–¹ï¼Œæˆ–è€…ä½¿ç”¨ `useMemo`ã€`useState`ï¼Œ
æˆ–è€…ä½¿ç”¨ç¬¬ä¸‰æ–¹çŠ¶æ€ç®¡ç†åº“ï¼ˆå¦‚ Redux æˆ– React Query ğŸ˜‰ï¼‰æ¥ä¸ºå˜é‡æä¾›"ç¨³å®š"çš„å¼•ç”¨ã€‚

```js
//âœ… æ­£ç¡®ï¼šåœ¨ç»„ä»¶å¤–éƒ¨å®šä¹‰ columns
const columns = [
  // ...
];

//âœ… æ­£ç¡®ï¼šåœ¨ç»„ä»¶å¤–éƒ¨å®šä¹‰ data
const data = [
  // ...
];

// é€šå¸¸ï¼Œåœ¨ç»„ä»¶å†…éƒ¨å®šä¹‰ columns å’Œ data æ›´å®ç”¨ï¼Œæ‰€ä»¥ä½¿ç”¨ `useMemo` æˆ– `useState` æ¥ç»™å®ƒä»¬æä¾›ç¨³å®šçš„å¼•ç”¨
export default function MyComponent() {
  //âœ… è‰¯å¥½ï¼šè¿™ä¸ä¼šå¯¼è‡´æ— é™é‡æ–°æ¸²æŸ“å¾ªç¯ï¼Œå› ä¸º `columns` æ˜¯ä¸€ä¸ªç¨³å®šçš„å¼•ç”¨
  const columns = useMemo(
    () => [
      // ...
    ],
    []
  );

  //âœ… è‰¯å¥½ï¼šè¿™ä¸ä¼šå¯¼è‡´æ— é™é‡æ–°æ¸²æŸ“å¾ªç¯ï¼Œå› ä¸º `data` æ˜¯ä¸€ä¸ªç¨³å®šçš„å¼•ç”¨
  const [data, setData] = useState(() => [
    // ...
  ]);

  // Columns å’Œ data å…·æœ‰ç¨³å®šçš„å¼•ç”¨ï¼Œä¸ä¼šå¯¼è‡´æ— é™å¾ªç¯ï¼
  const table = useReactTable({
    columns,
    data,
  });

  return <table>...</table>;
}
```

### é™·é˜±äºŒï¼šåŸåœ°ä¿®æ”¹ columns æˆ– data

å³ä½¿ä½ ä¸ºåˆå§‹çš„ `columns` å’Œ `data` æä¾›äº†ç¨³å®šçš„å¼•ç”¨ï¼Œä½†å¦‚æœä½ åœ¨åŸåœ°ä¿®æ”¹å®ƒä»¬ï¼Œä»ç„¶å¯èƒ½é™·å…¥æ— é™å¾ªç¯ã€‚
è¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„é™·é˜±ï¼Œä¸€å¼€å§‹ä½ å¯èƒ½ä¸ä¼šæ³¨æ„åˆ°ã€‚å¦‚æœä½ ä¸å°å¿ƒï¼Œåƒå†…è”çš„ `data.filter()` è¿™æ ·ç®€å•çš„æ“ä½œä¹Ÿå¯èƒ½å¯¼è‡´æ— é™å¾ªç¯ã€‚

```js
export default function MyComponent() {
  //âœ… è‰¯å¥½
  const columns = useMemo(
    () => [
      // ...
    ],
    []
  );

  //âœ… è‰¯å¥½ï¼ˆReact Query è‡ªåŠ¨ä¸º data æä¾›ç¨³å®šçš„å¼•ç”¨ï¼‰
  const { data, isLoading } = useQuery({
    //...
  });

  const table = useReactTable({
    columns,
    //âŒ é”™è¯¯ï¼šè¿™ä¼šå¯¼è‡´æ— é™é‡æ–°æ¸²æŸ“å¾ªç¯ï¼Œå› ä¸º `data` è¢«åŸåœ°ä¿®æ”¹äº†ï¼ˆç ´åäº†ç¨³å®šå¼•ç”¨ï¼‰
    data: data?.filter((d) => d.isActive) ?? [],
  });

  return <table>...</table>;
}
```

### è§£å†³æ–¹æ¡ˆäºŒï¼šå¯¹æ•°æ®è½¬æ¢è¿›è¡Œ Memoize

ä¸ºäº†é˜²æ­¢æ— é™å¾ªç¯ï¼Œä½ åº”è¯¥å§‹ç»ˆå¯¹æ•°æ®è½¬æ¢è¿›è¡Œ Memoizeã€‚
è¿™å¯ä»¥é€šè¿‡ `useMemo` æˆ–ç±»ä¼¼æ–¹æ³•å®ç°ã€‚

```js
export default function MyComponent() {
  //âœ… è‰¯å¥½
  const columns = useMemo(
    () => [
      // ...
    ],
    []
  );

  //âœ… è‰¯å¥½
  const { data, isLoading } = useQuery({
    //...
  });

  //âœ… è‰¯å¥½ï¼šè¿™ä¸ä¼šå¯¼è‡´æ— é™é‡æ–°æ¸²æŸ“å¾ªç¯ï¼Œå› ä¸º `filteredData` è¢« memoized äº†
  const filteredData = useMemo(
    () => data?.filter((d) => d.isActive) ?? [],
    [data]
  );

  const table = useReactTable({
    columns,
    data: filteredData, // ç¨³å®šçš„å¼•ç”¨ï¼
  });

  return <table>...</table>;
}
```

### React Forget

å½“ React Forget å‘å¸ƒåï¼Œè¿™äº›é—®é¢˜å¯èƒ½å°†æˆä¸ºè¿‡å»ã€‚æˆ–è€…ç›´æ¥ä½¿ç”¨ Solid.js... ğŸ¤“

## å½“æ•°æ®å˜åŒ–æ—¶ï¼Œå¦‚ä½•é˜»æ­¢è¡¨æ ¼çŠ¶æ€è‡ªåŠ¨é‡ç½®ï¼Ÿ

å¤§å¤šæ•°æ’ä»¶ä½¿ç”¨çš„çŠ¶æ€*é€šå¸¸åº”è¯¥*åœ¨æ•°æ®æºæ›´æ”¹æ—¶é‡ç½®ï¼Œä½†æœ‰æ—¶ä½ éœ€è¦é˜»æ­¢è¿™ç§æƒ…å†µå‘ç”Ÿï¼Œ
ä¾‹å¦‚å½“ä½ æ­£åœ¨å¤–éƒ¨è¿‡æ»¤æ•°æ®ã€åœ¨æŸ¥çœ‹æ•°æ®æ—¶ä»¥ä¸å¯å˜çš„æ–¹å¼ç¼–è¾‘æ•°æ®ï¼Œæˆ–è€…åªæ˜¯å¯¹æ•°æ®æ‰§è¡Œä»»ä½•ä½ ä¸æƒ³è§¦å‘æŸå—è¡¨æ ¼çŠ¶æ€è‡ªåŠ¨é‡ç½®çš„å¤–éƒ¨æ“ä½œæ—¶ã€‚

å¯¹äºè¿™äº›æƒ…å†µï¼Œæ¯ä¸ªæ’ä»¶éƒ½æä¾›äº†ä¸€ç§æ–¹æ³•ï¼Œç”¨äºåœ¨æ•°æ®æˆ–æŸå—çŠ¶æ€çš„å…¶ä»–ä¾èµ–é¡¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œç¦æ­¢å…¶å†…éƒ¨çŠ¶æ€è‡ªåŠ¨é‡ç½®ã€‚
é€šè¿‡å°†å®ƒä»¬ä¸­çš„ä»»ä½•ä¸€ä¸ªè®¾ç½®ä¸º `false`ï¼Œä½ å¯ä»¥é˜»æ­¢è§¦å‘è‡ªåŠ¨é‡ç½®ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºäº React çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†åœ¨ç¼–è¾‘è¡¨æ ¼çš„ `data` æºæ—¶ï¼Œå¦‚ä½•é˜»æ­¢å‡ ä¹æ‰€æœ‰çŠ¶æ€åƒé€šå¸¸é‚£æ ·å‘ç”Ÿå˜åŒ–ï¼š

```js
const [data, setData] = React.useState([])
const skipPageResetRef = React.useRef()

const updateData = newData => {
  // å½“ä½¿ç”¨æ­¤å‡½æ•°æ›´æ–°æ•°æ®æ—¶ï¼Œè®¾ç½®ä¸€ä¸ªæ ‡å¿—
  // ä»¥ç¦ç”¨æ‰€æœ‰çš„è‡ªåŠ¨é‡ç½®
  skipPageResetRef.current = true

  setData(newData)
}

React.useEffect(() => {
  // è¡¨æ ¼æ›´æ–°åï¼Œæ€»æ˜¯ç§»é™¤è¯¥æ ‡å¿—
  skipPageResetRef.current = false
})

useReactTable({
  ...
  autoResetPageIndex: !skipPageResetRef.current,
  autoResetExpanded: !skipPageResetRef.current,
})
```

ç°åœ¨ï¼Œå½“æˆ‘ä»¬æ›´æ–°æ•°æ®æ—¶ï¼Œä¸Šè¿°è¡¨æ ¼çŠ¶æ€å°†ä¸ä¼šè‡ªåŠ¨é‡ç½®ï¼
